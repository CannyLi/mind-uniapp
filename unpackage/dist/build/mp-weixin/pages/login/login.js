"use strict";const e=require("../../common/vendor.js"),s=require("../../stores/modules/userStore.js"),i={data:()=>({users_image:"",nickname:"",mobile_phone:""}),setup:()=>({userStore:s.useUserStore()}),methods:{chooseAvatar(){e.index.chooseImage({count:1,success:s=>{const i=s.tempFilePaths[0];e.index.getFileSystemManager().readFile({filePath:i,encoding:"base64",success:e=>{this.users_image="data:image/png;base64,"+e.data}})}})},handleSave(){if(!this.nickname||!this.mobile_phone)return void e.index.showToast({title:"请完整填写信息！",icon:"none"});if(!/^1[3-9]\d{9}$/.test(this.mobile_phone))return void e.index.showToast({title:"请输入有效的11位手机号",icon:"none"});e.index.showLoading({title:"保存中..."});let s=this.users_image;this.saveUserInfo(s)},saveUserInfo(s){e.index.request({url:"http://localhost:3000/api/saveUser",method:"POST",data:{users_image:s,nickname:this.nickname,mobile_phone:this.mobile_phone},success:i=>{if(console.log("后端响应:",i),e.index.hideLoading(),i.data.data.success){const o={users_image:s,nickname:this.nickname,mobile_phone:this.mobile_phone,users_id:i.data.data.userInfo.users_id};this.userStore.login(o),e.index.showToast({title:"设置保存成功",icon:"success"}),e.index.switchTab({url:"/pages/index/index"})}else e.index.showToast({title:i.data.data.msg,icon:"none"})},fail:s=>{e.index.hideLoading(),console.error("请求失败:",s),e.index.showToast({title:"请求失败，请稍后再试",icon:"none"})}})}},mounted(){this.userStore.loginStatus&&(this.users_image=this.userStore.userInfo.users_image,this.nickname=this.userStore.userInfo.nickname,this.mobile_phone=this.userStore.userInfo.mobile_phone)}};const o=e._export_sfc(i,[["render",function(s,i,o,n,t,a){return e.e({a:t.users_image},t.users_image?{b:t.users_image}:{},{c:e.o(((...e)=>a.chooseAvatar&&a.chooseAvatar(...e))),d:t.nickname,e:e.o((e=>t.nickname=e.detail.value)),f:t.mobile_phone,g:e.o((e=>t.mobile_phone=e.detail.value)),h:e.o(((...e)=>a.handleSave&&a.handleSave(...e)))})}],["__scopeId","data-v-44cf8316"]]);wx.createPage(o);
