"use strict";const t=require("../../../common/vendor.js"),e=require("../../../stores/modules/userStore.js"),n={setup(){const t=e.useUserStore();return t.initUser(),{userStore:t}},data:()=>({appointment:{user_real_name:"",user_mobile_phone:"",studentId:"",college:"",campus:"",appointmentDate:"",doctorIndex:0,consultIntentionIndex:0},doctors:[],consultIntentions:["心理咨询","职业规划","健康咨询"]}),mounted(){this.fetchDoctors()},methods:{fetchDoctors(){t.index.request({url:"http://localhost:3000/api/doctors",method:"GET",success:e=>{"0"===e.data.success?this.doctors=e.data.data.map((t=>t.name)):t.index.showToast({title:"获取医生列表失败",icon:"none"})},fail:()=>{t.index.showToast({title:"请求失败，请重试",icon:"none"})}})},submitAppointment(){const e={user_real_name:this.appointment.user_real_name,user_mobile_phone:this.appointment.user_mobile_phone,studentId:this.appointment.studentId,college:this.appointment.college,campus:this.appointment.campus,appointmentDate:this.appointment.appointmentDate,consultIntention:this.consultIntentions[this.appointment.consultIntentionIndex]};console.log("提交的预约数据:",e),t.index.request({url:"http://localhost:3000/api/appointments",method:"POST",data:{users_id:this.userStore.userInfo.users_id,...e},success:e=>{console.log("请求成功:",e),t.index.showToast({title:e.data.message||"预约成功",icon:"success"}),t.index.navigateBack({delta:1})},fail:e=>{console.error("请求失败:",e),t.index.showToast({title:e.message||"预约失败",icon:"none"}),console.error(e)}})},formReset(){this.appointment={user_real_name:"",user_mobile_phone:"",studentId:"",college:"",campus:"",appointmentDate:"",doctorIndex:0,consultIntentionIndex:0}},onDateChange(t){this.appointment.appointmentDate=t.detail.value},onDoctorChange(t){this.appointment.doctorIndex=t.detail.value},onConsultIntentionChange(t){this.appointment.consultIntentionIndex=t.detail.value}},onLoad(){this.userStore.loginStatus||(t.index.navigateTo({url:"/pages/login/login"}),t.index.showToast({title:"请先登录！",icon:"none",duration:2e3}))}};const o=t._export_sfc(n,[["render",function(e,n,o,s,a,i){return{a:a.appointment.user_real_name,b:t.o((t=>a.appointment.user_real_name=t.detail.value)),c:a.appointment.user_mobile_phone,d:t.o((t=>a.appointment.user_mobile_phone=t.detail.value)),e:a.appointment.studentId,f:t.o((t=>a.appointment.studentId=t.detail.value)),g:a.appointment.college,h:t.o((t=>a.appointment.college=t.detail.value)),i:a.appointment.campus,j:t.o((t=>a.appointment.campus=t.detail.value)),k:t.t(a.appointment.appointmentDate||"选择预约时间"),l:t.o(((...t)=>i.onDateChange&&i.onDateChange(...t))),m:t.t(a.doctors[a.appointment.doctorIndex]||"选择医师"),n:a.doctors,o:t.o(((...t)=>i.onDoctorChange&&i.onDoctorChange(...t))),p:t.t(a.consultIntentions[a.appointment.consultIntentionIndex]||"选择咨询意向"),q:a.consultIntentions,r:t.o(((...t)=>i.onConsultIntentionChange&&i.onConsultIntentionChange(...t))),s:t.o(((...t)=>i.submitAppointment&&i.submitAppointment(...t))),t:t.o(((...t)=>i.formReset&&i.formReset(...t)))}}],["__scopeId","data-v-31bc4c3d"]]);wx.createPage(o);
