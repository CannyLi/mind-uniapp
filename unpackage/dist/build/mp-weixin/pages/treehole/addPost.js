"use strict";const t=require("../../common/vendor.js"),e=require("../../stores/modules/userStore.js"),s={data:()=>({tag:"",posts_content:""}),setup(){const t=e.useUserStore();return t.initUser(),{userStore:t}},methods:{submitPost(){const{users_id:e,users_image:s}=this.userStore.userInfo;if(console.log("当前用户ID:",e),console.log("当前用户头像:",s),!e)return void t.index.showToast({title:"用户未登录，无法发布！",icon:"none"});const o=(new Date).toISOString().split("T")[0];t.index.request({url:"http://localhost:3000/api/posts",method:"POST",data:{date:o,tag:this.tag,posts_content:this.posts_content,users_id:e,users_image:s},success:e=>{"0"===e.data.success?(t.index.showToast({title:"发布成功",icon:"success"}),this.tag="",this.posts_content="",setTimeout((()=>{t.index.switchTab({url:"/pages/treehole/treehole"})}),1e3)):t.index.showToast({title:e.data.msg,icon:"none"})},fail:()=>{t.index.showToast({title:"网络错误",icon:"none"})}})}},onLoad(){this.userStore.loginStatus||(t.index.navigateTo({url:"/pages/LoginSignupHome/LoginSignupHome"}),t.index.showToast({title:"请先登录！",icon:"none",duration:2e3}))}};const o=t._export_sfc(s,[["render",function(e,s,o,n,i,a){return{a:i.posts_content,b:t.o((t=>i.posts_content=t.detail.value)),c:t.t(i.posts_content.length),d:i.tag,e:t.o((t=>i.tag=t.detail.value)),f:t.o(((...t)=>a.submitPost&&a.submitPost(...t)))}}],["__scopeId","data-v-27320648"]]);wx.createPage(o);
