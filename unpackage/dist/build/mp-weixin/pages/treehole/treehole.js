"use strict";const t=require("../../common/vendor.js"),e=require("../../stores/modules/userStore.js"),s={data:()=>({posts:[]}),setup(){const t=e.useUserStore();t.initUser();return{userStore:t,formatDate:t=>{if(!t)return"未填写";const e=new Date(t);return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`}}},methods:{fetchPosts(){t.index.request({url:"http://localhost:3000/api/posts",method:"GET",success:e=>{"0"===e.data.success?this.posts=e.data.data.map((t=>({...t,liked:!1,date:this.formatDate(t.date)}))):t.index.showToast({title:e.data.msg,icon:"none"})},fail:e=>{t.index.showToast({title:"加载失败，请稍后再试",icon:"none"})}})},toggleLike(e){const s=e.liked?`http://localhost:3000/api/posts/${e.posts_id}/unlike`:`http://localhost:3000/api/posts/${e.posts_id}/like`;t.index.request({url:s,method:"POST",success:s=>{if(s.data.success){e.liked=!e.liked,e.like_count+=e.liked?1:-1;const s=e.liked?"点赞成功":"取消点赞成功";t.index.showToast({title:s,icon:"success"})}else{const s=e.liked?"取消点赞失败":"点赞失败";t.index.showToast({title:s,icon:"none"})}},fail:e=>{t.index.showToast({title:"操作失败，请稍后再试",icon:"none"})}})},navigateToPublish(){t.index.navigateTo({url:"/pages/treehole/addPost"})}},onLoad(){this.userStore.loginStatus?this.fetchPosts():(t.index.navigateTo({url:"/pages/login/login"}),t.index.showToast({title:"请先登录！",icon:"none",duration:2e3}))}};const o=t._export_sfc(s,[["render",function(e,s,o,i,a,n){return{a:t.f(a.posts,((e,s,o)=>({a:e.users_image,b:t.t(e.nickname),c:t.t(e.date),d:t.t(e.posts_content),e:t.t(e.tag),f:t.t(e.like_count),g:e.liked?1:"",h:t.o((t=>n.toggleLike(e)),e.id),i:e.id}))),b:t.o(((...t)=>n.navigateToPublish&&n.navigateToPublish(...t)))}}],["__scopeId","data-v-d3470b40"]]);wx.createPage(o);
