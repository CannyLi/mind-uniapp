"use strict";const e=require("../../common/vendor.js"),s=require("../../stores/modules/userStore.js"),t={setup(){const e=s.useUserStore();return e.initUser(),{userStore:e}},data:()=>({messages:[],inputMessage:""}),onLoad(){this.userStore.loginStatus||(e.index.navigateTo({url:"/pages/login/login"}),e.index.showToast({title:"请先登录！",icon:"none",duration:2e3}))},methods:{sendMessage(){if(""!==this.inputMessage.trim()){const e={text:this.inputMessage,isUser:!0};this.messages.push(e),this.inputMessage="",this.getAIChatResponse(e.text).then((e=>{this.messages.push({text:e,isUser:!1})})).catch((e=>{console.error("获取AI回复失败：",e)}))}else console.log("输入框为空，未发送消息")},getAIChatResponse:s=>new Promise(((t,a)=>{const i={perception:{inputText:{text:s}}};e.index.request({url:"http://localhost:3000/api/aiconsult",method:"POST",data:i,success:e=>{e.data&&e.data.results&&e.data.results[0].values?t(e.data.results[0].values.text):a("响应格式错误")},fail:e=>{a(e)}})}))}};const a=e._export_sfc(t,[["render",function(s,t,a,i,r,n){return{a:e.f(r.messages,((s,t,a)=>({a:(s.isUser,"/static/images/Swiper/swiper1.jpg"),b:e.n({"user-avatar":s.isUser,"ai-avatar":!s.isUser}),c:e.t(s.text),d:t,e:s.isUser?1:"",f:s.isUser?"":1}))),b:e.o(((...e)=>n.sendMessage&&n.sendMessage(...e))),c:r.inputMessage,d:e.o((e=>r.inputMessage=e.detail.value)),e:e.o(((...e)=>n.sendMessage&&n.sendMessage(...e)))}}]]);wx.createPage(a);
