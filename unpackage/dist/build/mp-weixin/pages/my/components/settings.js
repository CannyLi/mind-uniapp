"use strict";const e=require("../../../common/vendor.js"),o=require("../../../stores/modules/userStore.js"),t={setup(){const t=o.useUserStore(),s=e.ref(!0),n=e.ref(t.userInfo.nickname||""),a=e.ref(t.userInfo.real_name||""),r=e.ref(t.userInfo.gender||""),i=e.ref(t.userInfo.mobile_phone||""),u=e.ref(t.userInfo.birthday||""),d=e.ref(t.userInfo.email||""),l=e.ref(t.userInfo.campus||""),c=e.ref(t.userInfo.users_image||""),m=async()=>{try{const o=await e.index.request({url:"http://localhost:3000/api/getUserInfo",method:"GET",data:{mobile_phone:t.userInfo.mobile_phone}});if(console.log("refreshUserInfo response",o),200===o.statusCode){const e=o.data.data.userInfo;t.userInfo={...t.userInfo,...e,birthday:f(e.birthday)}}else e.index.showToast({title:"获取用户信息失败",icon:"none",duration:2e3})}catch(o){console.error("获取用户信息错误:",o),e.index.showToast({title:"网络错误，请稍后再试。",icon:"none",duration:2e3})}},f=e=>{if(!e)return"未填写";const o=new Date(e);return`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`};return e.onMounted((async()=>{if(console.log("userStore.userInfo:",t.userInfo),!t.loginStatus)return e.index.navigateTo({url:"/pages/login/login"}),void e.index.showToast({title:"请先登录！",icon:"none",duration:2e3});try{const o=await e.index.request({url:"http://localhost:3000/api/getUserInfo",method:"GET",data:{mobile_phone:t.userInfo.mobile_phone}});if(console.log("response.statusCode",o.statusCode),console.log("response.data.success",o.data),200===o.statusCode){const e=o.data.data.userInfo;t.userInfo={...t.userInfo,...e,birthday:f(e.birthday)}}else e.index.showToast({title:"获取用户信息失败",icon:"none",duration:2e3})}catch(o){console.error("获取用户信息错误:",o),e.index.showToast({title:"网络错误，请稍后再试。",icon:"none",duration:2e3})}})),{userStore:t,isEditing:s,nickname:n,realName:a,gender:r,mobilePhone:i,birthday:u,email:d,campus:l,usersImage:c,chooseAvatar:()=>{e.index.chooseImage({count:1,success:o=>{const t=o.tempFilePaths[0];e.index.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:e=>{c.value="data:image/png;base64,"+e.data}})}})},handleSave:async()=>{try{const o=await e.index.request({url:"http://localhost:3000/api/updateUser",method:"POST",data:{users_id:t.userInfo.users_id,nickname:n.value,real_name:a.value,mobile_phone:i.value,gender:r.value,birthday:u.value,email:d.value,campus:l.value,users_image:c.value}});console.log("response",o),200===o.statusCode?(e.index.showToast({title:o.data.msg||"用户信息修改成功",icon:"success",duration:2e3}),e.index.navigateBack({delta:1}),await m()):e.index.showToast({title:o.data.msg||"修改失败，请检查日期格式",icon:"none",duration:2e3})}catch(o){console.error("更新用户信息错误:",o),e.index.showToast({title:"网络错误，请稍后再试。",icon:"none",duration:2e3})}}}}};const s=e._export_sfc(t,[["render",function(o,t,s,n,a,r){return e.e({a:n.userStore.userInfo.users_image,b:e.o(((...e)=>n.chooseAvatar&&n.chooseAvatar(...e))),c:n.isEditing},n.isEditing?{d:n.userStore.userInfo.nickname||"未填写",e:n.nickname,f:e.o((e=>n.nickname=e.detail.value))}:{g:e.t(n.userStore.userInfo.nickname)},{h:n.isEditing},n.isEditing?{i:n.userStore.userInfo.real_name||"未填写",j:n.realName,k:e.o((e=>n.realName=e.detail.value))}:{l:e.t(n.userStore.userInfo.real_name)},{m:n.isEditing},n.isEditing?{n:n.userStore.userInfo.gender||"未填写",o:n.gender,p:e.o((e=>n.gender=e.detail.value))}:{q:e.t(n.userStore.userInfo.gender)},{r:n.isEditing},n.isEditing?{s:n.userStore.userInfo.mobile_phone||"未填写",t:n.mobilePhone,v:e.o((e=>n.mobilePhone=e.detail.value))}:{w:e.t(n.userStore.userInfo.mobile_phone)},{x:n.isEditing},n.isEditing?{y:n.userStore.userInfo.birthday||"格式必须是YY-MM-DD",z:n.birthday,A:e.o((e=>n.birthday=e.detail.value))}:{B:e.t(n.userStore.userInfo.birthday)},{C:n.isEditing},n.isEditing?{D:n.userStore.userInfo.email||"未填写",E:n.email,F:e.o((e=>n.email=e.detail.value))}:{G:e.t(n.userStore.userInfo.email)},{H:n.isEditing},n.isEditing?{I:n.userStore.userInfo.campus||"未填写",J:n.campus,K:e.o((e=>n.campus=e.detail.value))}:{L:e.t(n.userStore.userInfo.campus)},{M:e.o(((...e)=>n.handleSave&&n.handleSave(...e))),N:!n.isEditing})}],["__scopeId","data-v-673333de"]]);wx.createPage(s);
